# Setup the feature groups for the Flink pipelines
import pandas as pd
import hopsworks
from hsfs.feature import Feature
from datetime import datetime, timedelta, timezone

project = hopsworks.login()
fs = project.get_feature_store()

features = [
    Feature(name="k8scluster_id", type="bigint"),
    Feature(name="k8scluster_name", type="string"),
    Feature(name="total_vulnerabilities", type="bigint"),
    Feature(name="most_severe_vulnerability", type="int"),
]

k8_vulnerability_fg = fs.get_or_create_feature_group(
    name="k8_vulnerability",
    description="k8s cluster vulnerability stats.",
    version=1,
    primary_key=["k8scluster_id"],
#    partition_key=["interaction_month"],
    online_enabled=True,
#    event_time="interaction_date"
)

k8_vulnerability_fg.save(features)

k8_vulnerability_fg.materialization_job.schedule(cron_expression="0 */15 * ? * *",
                                                 start_time=datetime.now(tz=timezone.utc))
